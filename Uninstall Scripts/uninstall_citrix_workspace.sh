#!/bin/bash
# Uninstall script for Citrix Workspace
# Generated by IntuneBrew

# Exit on error
set -e

echo "Uninstalling Citrix Workspace..."

# Check if running as root
if [ "$EUID" -ne 0 ]; then
  echo "Please run as root"
  exit 1
fi

# Kill application process if running
echo "Stopping Citrix Workspace if running..."
pkill -f "Citrix Workspace" 2>/dev/null || true

# Unload service com.citrix.AuthManager_Mac
echo "Unloading service com.citrix.AuthManager_Mac..."
launchctl unload -w /Library/LaunchAgents/com.citrix.AuthManager_Mac.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.citrix.AuthManager_Mac.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.citrix.AuthManager_Mac.plist 2>/dev/null || true

# Unload service com.citrix.ctxusbd
echo "Unloading service com.citrix.ctxusbd..."
launchctl unload -w /Library/LaunchAgents/com.citrix.ctxusbd.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.citrix.ctxusbd.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.citrix.ctxusbd.plist 2>/dev/null || true

# Unload service com.citrix.CtxWorkspaceHelperDaemon
echo "Unloading service com.citrix.CtxWorkspaceHelperDaemon..."
launchctl unload -w /Library/LaunchAgents/com.citrix.CtxWorkspaceHelperDaemon.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.citrix.CtxWorkspaceHelperDaemon.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.citrix.CtxWorkspaceHelperDaemon.plist 2>/dev/null || true

# Unload service com.citrix.ctxworkspaceupdater
echo "Unloading service com.citrix.ctxworkspaceupdater..."
launchctl unload -w /Library/LaunchAgents/com.citrix.ctxworkspaceupdater.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.citrix.ctxworkspaceupdater.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.citrix.ctxworkspaceupdater.plist 2>/dev/null || true

# Unload service com.citrix.ReceiverHelper
echo "Unloading service com.citrix.ReceiverHelper..."
launchctl unload -w /Library/LaunchAgents/com.citrix.ReceiverHelper.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.citrix.ReceiverHelper.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.citrix.ReceiverHelper.plist 2>/dev/null || true

# Unload service com.citrix.safariadapter
echo "Unloading service com.citrix.safariadapter..."
launchctl unload -w /Library/LaunchAgents/com.citrix.safariadapter.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.citrix.safariadapter.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.citrix.safariadapter.plist 2>/dev/null || true

# Unload service com.citrix.ServiceRecords
echo "Unloading service com.citrix.ServiceRecords..."
launchctl unload -w /Library/LaunchAgents/com.citrix.ServiceRecords.plist 2>/dev/null || true
launchctl unload -w /Library/LaunchDaemons/com.citrix.ServiceRecords.plist 2>/dev/null || true
launchctl unload -w ~/Library/LaunchAgents/com.citrix.ServiceRecords.plist 2>/dev/null || true

# Kill application with bundle ID Citrix.ServiceRecords if running
echo "Stopping application with bundle ID Citrix.ServiceRecords if running..."
killall -9 "Citrix.ServiceRecords" 2>/dev/null || true

# Kill application with bundle ID com.citrix.CitrixReceiverLauncher if running
echo "Stopping application with bundle ID com.citrix.CitrixReceiverLauncher if running..."
killall -9 "com.citrix.CitrixReceiverLauncher" 2>/dev/null || true

# Kill application with bundle ID com.citrix.receiver.nomas if running
echo "Stopping application with bundle ID com.citrix.receiver.nomas if running..."
killall -9 "com.citrix.receiver.nomas" 2>/dev/null || true

# Kill application with bundle ID com.citrix.ReceiverHelper if running
echo "Stopping application with bundle ID com.citrix.ReceiverHelper if running..."
killall -9 "com.citrix.ReceiverHelper" 2>/dev/null || true

# Remove $HOME/Library/Application Support/Citrix Receiver
echo "Removing $HOME/Library/Application Support/Citrix Receiver..."
if [ -d "$HOME/Library/Application Support/Citrix Receiver" ]; then
    rm -rf "$HOME/Library/Application Support/Citrix Receiver" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/Citrix Receiver" ]; then
    rm -f "$HOME/Library/Application Support/Citrix Receiver" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/Citrix Workspace
echo "Removing $HOME/Library/Application Support/Citrix Workspace..."
if [ -d "$HOME/Library/Application Support/Citrix Workspace" ]; then
    rm -rf "$HOME/Library/Application Support/Citrix Workspace" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/Citrix Workspace" ]; then
    rm -f "$HOME/Library/Application Support/Citrix Workspace" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/Citrix
echo "Removing $HOME/Library/Application Support/Citrix..."
if [ -d "$HOME/Library/Application Support/Citrix" ]; then
    rm -rf "$HOME/Library/Application Support/Citrix" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/Citrix" ]; then
    rm -f "$HOME/Library/Application Support/Citrix" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/com.citrix.CitrixReceiverLauncher
echo "Removing $HOME/Library/Application Support/com.citrix.CitrixReceiverLauncher..."
if [ -d "$HOME/Library/Application Support/com.citrix.CitrixReceiverLauncher" ]; then
    rm -rf "$HOME/Library/Application Support/com.citrix.CitrixReceiverLauncher" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/com.citrix.CitrixReceiverLauncher" ]; then
    rm -f "$HOME/Library/Application Support/com.citrix.CitrixReceiverLauncher" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/com.citrix.HdxRtcEngine
echo "Removing $HOME/Library/Application Support/com.citrix.HdxRtcEngine..."
if [ -d "$HOME/Library/Application Support/com.citrix.HdxRtcEngine" ]; then
    rm -rf "$HOME/Library/Application Support/com.citrix.HdxRtcEngine" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/com.citrix.HdxRtcEngine" ]; then
    rm -f "$HOME/Library/Application Support/com.citrix.HdxRtcEngine" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/com.citrix.receiver*
echo "Removing $HOME/Library/Application Support/com.citrix.receiver*..."
if [ -d "$HOME/Library/Application Support/com.citrix.receiver*" ]; then
    rm -rf "$HOME/Library/Application Support/com.citrix.receiver*" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/com.citrix.receiver*" ]; then
    rm -f "$HOME/Library/Application Support/com.citrix.receiver*" 2>/dev/null || true
fi

# Remove $HOME/Library/Application Support/com.citrix.ReceiverUpdater
echo "Removing $HOME/Library/Application Support/com.citrix.ReceiverUpdater..."
if [ -d "$HOME/Library/Application Support/com.citrix.ReceiverUpdater" ]; then
    rm -rf "$HOME/Library/Application Support/com.citrix.ReceiverUpdater" 2>/dev/null || true
elif [ -f "$HOME/Library/Application Support/com.citrix.ReceiverUpdater" ]; then
    rm -f "$HOME/Library/Application Support/com.citrix.ReceiverUpdater" 2>/dev/null || true
fi

# Remove $HOME/Library/Caches/com.citrix.receiver*
echo "Removing $HOME/Library/Caches/com.citrix.receiver*..."
if [ -d "$HOME/Library/Caches/com.citrix.receiver*" ]; then
    rm -rf "$HOME/Library/Caches/com.citrix.receiver*" 2>/dev/null || true
elif [ -f "$HOME/Library/Caches/com.citrix.receiver*" ]; then
    rm -f "$HOME/Library/Caches/com.citrix.receiver*" 2>/dev/null || true
fi

# Remove $HOME/Library/HTTPStorages/com.citrix.CitrixReceiverLauncher
echo "Removing $HOME/Library/HTTPStorages/com.citrix.CitrixReceiverLauncher..."
if [ -d "$HOME/Library/HTTPStorages/com.citrix.CitrixReceiverLauncher" ]; then
    rm -rf "$HOME/Library/HTTPStorages/com.citrix.CitrixReceiverLauncher" 2>/dev/null || true
elif [ -f "$HOME/Library/HTTPStorages/com.citrix.CitrixReceiverLauncher" ]; then
    rm -f "$HOME/Library/HTTPStorages/com.citrix.CitrixReceiverLauncher" 2>/dev/null || true
fi

# Remove $HOME/Library/HTTPStorages/com.citrix.receiver*
echo "Removing $HOME/Library/HTTPStorages/com.citrix.receiver*..."
if [ -d "$HOME/Library/HTTPStorages/com.citrix.receiver*" ]; then
    rm -rf "$HOME/Library/HTTPStorages/com.citrix.receiver*" 2>/dev/null || true
elif [ -f "$HOME/Library/HTTPStorages/com.citrix.receiver*" ]; then
    rm -f "$HOME/Library/HTTPStorages/com.citrix.receiver*" 2>/dev/null || true
fi

# Remove $HOME/Library/Logs/Citrix Workspace
echo "Removing $HOME/Library/Logs/Citrix Workspace..."
if [ -d "$HOME/Library/Logs/Citrix Workspace" ]; then
    rm -rf "$HOME/Library/Logs/Citrix Workspace" 2>/dev/null || true
elif [ -f "$HOME/Library/Logs/Citrix Workspace" ]; then
    rm -f "$HOME/Library/Logs/Citrix Workspace" 2>/dev/null || true
fi

# Remove $HOME/Library/Preferences/com.citrix.AuthManager.plist
echo "Removing $HOME/Library/Preferences/com.citrix.AuthManager.plist..."
if [ -d "$HOME/Library/Preferences/com.citrix.AuthManager.plist" ]; then
    rm -rf "$HOME/Library/Preferences/com.citrix.AuthManager.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/Preferences/com.citrix.AuthManager.plist" ]; then
    rm -f "$HOME/Library/Preferences/com.citrix.AuthManager.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/Preferences/com.citrix.CitrixReceiverLauncher.plist
echo "Removing $HOME/Library/Preferences/com.citrix.CitrixReceiverLauncher.plist..."
if [ -d "$HOME/Library/Preferences/com.citrix.CitrixReceiverLauncher.plist" ]; then
    rm -rf "$HOME/Library/Preferences/com.citrix.CitrixReceiverLauncher.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/Preferences/com.citrix.CitrixReceiverLauncher.plist" ]; then
    rm -f "$HOME/Library/Preferences/com.citrix.CitrixReceiverLauncher.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/Preferences/com.citrix.HdxRtcEngine.plist
echo "Removing $HOME/Library/Preferences/com.citrix.HdxRtcEngine.plist..."
if [ -d "$HOME/Library/Preferences/com.citrix.HdxRtcEngine.plist" ]; then
    rm -rf "$HOME/Library/Preferences/com.citrix.HdxRtcEngine.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/Preferences/com.citrix.HdxRtcEngine.plist" ]; then
    rm -f "$HOME/Library/Preferences/com.citrix.HdxRtcEngine.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/Preferences/com.citrix.receiver*.plist
echo "Removing $HOME/Library/Preferences/com.citrix.receiver*.plist..."
if [ -d "$HOME/Library/Preferences/com.citrix.receiver*.plist" ]; then
    rm -rf "$HOME/Library/Preferences/com.citrix.receiver*.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/Preferences/com.citrix.receiver*.plist" ]; then
    rm -f "$HOME/Library/Preferences/com.citrix.receiver*.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/Preferences/com.citrix.Receiver*.plist
echo "Removing $HOME/Library/Preferences/com.citrix.Receiver*.plist..."
if [ -d "$HOME/Library/Preferences/com.citrix.Receiver*.plist" ]; then
    rm -rf "$HOME/Library/Preferences/com.citrix.Receiver*.plist" 2>/dev/null || true
elif [ -f "$HOME/Library/Preferences/com.citrix.Receiver*.plist" ]; then
    rm -f "$HOME/Library/Preferences/com.citrix.Receiver*.plist" 2>/dev/null || true
fi

# Remove $HOME/Library/Saved Application State/com.citrix.receiver.nomas.savedState
echo "Removing $HOME/Library/Saved Application State/com.citrix.receiver.nomas.savedState..."
if [ -d "$HOME/Library/Saved Application State/com.citrix.receiver.nomas.savedState" ]; then
    rm -rf "$HOME/Library/Saved Application State/com.citrix.receiver.nomas.savedState" 2>/dev/null || true
elif [ -f "$HOME/Library/Saved Application State/com.citrix.receiver.nomas.savedState" ]; then
    rm -f "$HOME/Library/Saved Application State/com.citrix.receiver.nomas.savedState" 2>/dev/null || true
fi

# Remove $HOME/Library/WebKit/com.citrix.receiver.nomas
echo "Removing $HOME/Library/WebKit/com.citrix.receiver.nomas..."
if [ -d "$HOME/Library/WebKit/com.citrix.receiver.nomas" ]; then
    rm -rf "$HOME/Library/WebKit/com.citrix.receiver.nomas" 2>/dev/null || true
elif [ -f "$HOME/Library/WebKit/com.citrix.receiver.nomas" ]; then
    rm -f "$HOME/Library/WebKit/com.citrix.receiver.nomas" 2>/dev/null || true
fi

echo "Uninstallation complete!"
exit 0
